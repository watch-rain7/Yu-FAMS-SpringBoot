# 固定资产管理系统 - 企业微信/钉钉集成功能

## 功能概述

本次更新为固定资产管理系统添加了企业微信和钉钉集成功能，提升了系统的现代化程度和用户体验。

## 主要改进

### 1. 修复系统BUG
- **修复员工默认权限BUG**：新建员工时默认角色从ADMIN改为STAFF
- **改进登录体验**：添加企业微信和钉钉登录选项

### 2. 企业微信集成功能
- **企业微信登录**：支持通过企业微信扫码登录
- **消息推送**：支持向企业微信用户发送消息通知
- **配置管理**：提供企业微信应用配置管理界面
- **授权验证**：支持企业微信授权URL生成和验证

### 3. 钉钉集成功能（预留）
- **钉钉登录**：预留钉钉登录接口
- **配置管理**：提供钉钉应用配置管理界面

## 技术架构

### 后端技术栈
- Spring Boot 2.x
- MyBatis
- Hutool工具库
- 企业微信API集成

### 前端技术栈
- Vue.js 2.x
- Element UI
- Vue Router

## 数据库设计

### 新增表结构
1. **wechat_work_config** - 企业微信配置表
2. **dingtalk_config** - 钉钉配置表  
3. **third_party_user** - 第三方登录用户关联表

## 功能模块

### 1. 集成管理模块
- 位置：管理端 → 集成管理
- 功能：
  - 企业微信配置管理
  - 钉钉配置管理
  - 配置验证测试
  - 消息发送测试

### 2. 第三方登录
- 企业微信登录流程
- 钉钉登录流程（预留）
- 用户信息同步

## 使用说明

### 企业微信集成配置

1. **获取企业微信应用信息**
   - 登录企业微信管理后台
   - 创建自建应用
   - 获取企业ID、应用Secret、应用ID

2. **配置系统参数**
   - 进入管理端 → 集成管理 → 企业微信集成
   - 填写企业ID、应用Secret、应用ID
   - 点击"测试配置"验证连接
   - 保存配置

3. **配置回调地址**
   - 在企业微信管理后台设置回调地址
   - 回调地址：`https://your-domain.com/wechat-callback`
   - 设置Token和EncodingAESKey

### 钉钉集成配置（预留）

1. **获取钉钉应用信息**
   - 登录钉钉开放平台
   - 创建企业内部应用
   - 获取AppKey、AppSecret、企业ID

2. **配置系统参数**
   - 进入管理端 → 集成管理 → 钉钉集成
   - 填写AppKey、AppSecret、企业ID
   - 保存配置

## API接口

### 企业微信相关接口

#### 1. 获取授权URL
```
GET /integration/wechat/authUrl?redirectUri={redirectUri}
```

#### 2. 企业微信登录
```
POST /integration/wechat/login?code={code}
```

#### 3. 发送消息
```
POST /integration/wechat/sendMessage?userId={userId}&content={content}
```

#### 4. 验证配置
```
POST /integration/wechat/validate
Content-Type: application/json
{
  "corpId": "企业ID",
  "agentSecret": "应用Secret",
  "agentId": "应用ID"
}
```

## 部署说明

### 1. 数据库初始化
执行 `springboot/src/main/resources/sql/integration_tables.sql` 创建相关表结构。

### 2. 配置企业微信应用
1. 在企业微信管理后台创建应用
2. 配置可信域名
3. 设置回调地址

### 3. 环境变量配置
```properties
# 企业微信配置（可选）
WECHAT_WORK_CORP_ID=your_corp_id
WECHAT_WORK_AGENT_SECRET=your_agent_secret
WECHAT_WORK_AGENT_ID=your_agent_id
```

## 安全考虑

1. **敏感信息加密**：应用Secret等敏感信息建议加密存储
2. **访问控制**：集成管理功能仅管理员可访问
3. **日志记录**：记录第三方登录和消息发送日志
4. **异常处理**：完善的异常处理和错误提示

## 扩展性设计

### 1. 插件化架构
- 集成功能采用插件化设计
- 支持添加更多第三方平台
- 配置管理统一化

### 2. 消息模板
- 支持自定义消息模板
- 支持多种消息类型（文本、图片、链接等）
- 支持消息发送策略

### 3. 用户同步
- 支持企业微信用户信息同步
- 支持组织架构同步
- 支持权限映射

## 后续优化方向

1. **完善钉钉集成**：实现完整的钉钉登录和消息推送功能
2. **消息模板管理**：提供可视化的消息模板编辑功能
3. **用户权限映射**：支持企业微信/钉钉用户与系统角色的映射
4. **数据同步**：支持组织架构和用户信息的自动同步
5. **移动端适配**：优化移动端的企业微信集成体验

## 注意事项

1. 企业微信应用需要配置可信域名
2. 回调地址需要支持HTTPS
3. 企业微信API有调用频率限制
4. 建议在生产环境中使用数据库存储配置信息
5. 定期检查企业微信应用的授权状态

## 技术支持

如有问题，请联系开发团队或查看系统日志获取详细错误信息。 